# weaviate-deom

This repository is a demo of weaviate, a knowledge graph database. This demo will show how to use weaviate to store and query data.

we used a docker container inside docker-compose.yaml file to run a weaviate instance on port 8080, and a python script to upload data to weaviate.

## Prerequisites
1. docker & docker-compose installed
2. git installed
3. python 3+ and pip installed

## Installation
1. Clone this repository: `git clone https://github.com/najmi9/weaviate-deom.git`
2. Run `docker-compose up -d` in the root directory of this repository
3. Run `pip install -r requirements.txt` in the root directory of this repository
4. Run `python3 app.py` in the root directory of this repository


the script will take a while to run, as it will download the packages and upload it to weaviate.

## Usage
To see if weaviate instance is alive open `http://localhost:8080` in your browser.

you test the weaviate instance by running `python3 test_weavaite.py` in the root directory of this repository.

You have a `docker-compose` file for the Weaviate service. If you want to deploy this to a Kubernetes cluster, the steps are as follows:


### Deploying Weaviate to Kubernetes(Generated by ChatGPT-4)

1. **Docker Image**: The Docker image you're using is `semitechnologies/weaviate:1.20.5`. If your Kubernetes cluster can access Docker Hub, then you don't need to push the image to another registry. If not, you'll need to push it to a container registry your cluster can access.

2. **Convert `docker-compose.yml` to Kubernetes Manifests**: There are tools like `kompose` that can help automate this step, but they might not get everything perfect, so manual adjustments are often needed.

   ```bash
   kompose convert -f docker-compose.yml
   ```

   This will generate Kubernetes YAML files. However, for our tutorial, let's create them manually to have better control.

3. **Create a Deployment File** (`weaviate-deployment.yaml`):

   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: weaviate-deployment
   spec:
     replicas: 1
     selector:
       matchLabels:
         app: weaviate
     template:
       metadata:
         labels:
           app: weaviate
       spec:
         containers:
           - name: weaviate
             image: cr.weaviate.io/semitechnologies/weaviate:1.20.5
             ports:
             - containerPort: 8080
             env:
               - name: HUGGINGFACE_APIKEY
                 valueFrom:
                   secretKeyRef:
                     name: weaviate-secrets
                     key: HUGGINGFACE_APIKEY
               # Add other environment variables similarly
             volumeMounts:
             - mountPath: /var/lib/weaviate
               name: weaviate-data
         volumes:
           - name: weaviate-data
             persistentVolumeClaim:
               claimName: weaviate-pvc
   ```

4. **Persistent Storage**:

   Create a PersistentVolumeClaim (`weaviate-pvc.yaml`):

   ```yaml
   apiVersion: v1
   kind: PersistentVolumeClaim
   metadata:
     name: weaviate-pvc
   spec:
     accessModes:
     - ReadWriteOnce
     resources:
       requests:
         storage: 10Gi # Modify size as needed
   ```

   Apply it:

   ```bash
   kubectl apply -f weaviate-pvc.yaml
   ```

5. **Environment Variables**:

   Create a secret for your environment variables (`weaviate-secret.yaml`):

   ```yaml
   apiVersion: v1
   kind: Secret
   metadata:
     name: weaviate-secrets
   type: Opaque
   stringData:
     HUGGINGFACE_APIKEY: 'your_huggingface_api_key'
     # Add other environment variables similarly
   ```

   Apply the secret:

   ```bash
   kubectl apply -f weaviate-secret.yaml
   ```

6. **Apply Deployment**:

   ```bash
   kubectl apply -f weaviate-deployment.yaml
   ```

7. **Expose Your Service** (using a `NodePort` service for simplicity):

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: weaviate-service
   spec:
     selector:
       app: weaviate
     ports:
       - protocol: TCP
         port: 8080
         targetPort: 8080
     type: NodePort
   ```

   Apply it:

   ```bash
   kubectl apply -f weaviate-service.yaml
   ```

With these steps, you should have Weaviate running on Kubernetes. Adjustments might be necessary based on your specific cluster setup or any additional configurations specific to your use case.
